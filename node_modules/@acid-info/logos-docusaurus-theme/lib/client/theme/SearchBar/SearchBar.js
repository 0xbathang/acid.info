"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SearchBar = void 0;
const tslib_1 = require("tslib");
const lsd_react_1 = require("@acid-info/lsd-react");
const react_1 = tslib_1.__importStar(require("react"));
const Modal_1 = require("../../components/Modal/Modal");
const usePersistedHistory_1 = require("../../lib/usePersistedHistory");
const useWindowEventListener_1 = require("../../lib/useWindowEventListener");
const useSearch_1 = require("./hooks/useSearch");
const SearchBar_module_scss_1 = tslib_1.__importDefault(require("./SearchBar.module.scss"));
const SearchHistory_1 = require("./SearchHistory/SearchHistory");
const SearchInput_1 = require("./SearchInput/SearchInput");
const SearchResults_1 = require("./SearchResults/SearchResults");
const SearchBar = ({}) => {
    const history = (0, usePersistedHistory_1.usePersistedHistory)('search', {
        unique: true,
        equals: (a, b) => a.title === b.title && a.href === b.href,
        maxItems: 10,
    });
    const search = (0, useSearch_1.useSearch)();
    const ref = (0, react_1.useRef)(null);
    const [input, setInput] = (0, react_1.useState)('');
    const [results, setResults] = (0, react_1.useState)([]);
    const [displayModal, setDisplayModal] = (0, react_1.useState)(false);
    const onInputChange = (e) => {
        setInput(e.target.value);
    };
    const focusOnInput = () => {
        const el = ref.current;
        if (!el)
            return;
        const inputEl = el.querySelector('input');
        if (inputEl)
            setTimeout(() => {
                inputEl.focus();
            }, 50);
    };
    const onClear = () => {
        setInput('');
    };
    const query = async (input) => {
        const { results } = await search.query(input);
        setResults(results);
    };
    (0, react_1.useEffect)(() => {
        if (input.length > 0)
            query(input);
        else
            setResults([]);
    }, [input]);
    (0, react_1.useEffect)(() => {
        displayModal ? focusOnInput() : setInput('');
    }, [displayModal]);
    const onNavigate = (e, item) => {
        e.preventDefault();
        setDisplayModal(false);
        history.add(item);
        window.location.href = item.href;
    };
    (0, useWindowEventListener_1.useWindowEventListener)('keydown', (event) => {
        if ((event.ctrlKey || event.metaKey) && event.code === 'KeyK') {
            event.preventDefault();
            setDisplayModal(true);
        }
    }, {}, []);
    return (react_1.default.createElement(react_1.default.Fragment, null,
        react_1.default.createElement(lsd_react_1.IconButton, { onClick: () => setDisplayModal(true), size: "medium" },
            react_1.default.createElement(lsd_react_1.SearchIcon, null)),
        react_1.default.createElement(Modal_1.Modal, { keepMounted: true, id: "search-modal", open: displayModal, onClose: () => setDisplayModal(false), className: SearchBar_module_scss_1.default.modal },
            react_1.default.createElement("div", { className: SearchBar_module_scss_1.default.header },
                react_1.default.createElement(SearchInput_1.SearchInput, { containerRef: ref, onClear: onClear, value: input, onChange: onInputChange }),
                react_1.default.createElement(lsd_react_1.IconButton, { className: SearchBar_module_scss_1.default.closeButton, size: "medium", onClick: () => setDisplayModal(false) },
                    react_1.default.createElement(lsd_react_1.CloseIcon, { color: "primary" }))),
            input.length > 0 && (react_1.default.createElement(SearchResults_1.SearchResults, { results: results, onNavigate: onNavigate })),
            input.length === 0 && (react_1.default.createElement(SearchHistory_1.SearchHistory, { history: history.list ?? [], onRemove: history.removeByIndex, onClose: () => setDisplayModal(false) })))));
};
exports.SearchBar = SearchBar;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbGllbnQvdGhlbWUvU2VhcmNoQmFyL1NlYXJjaEJhci50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLG9EQUF3RTtBQUN4RSx1REFBMEQ7QUFDMUQsd0RBQW9EO0FBQ3BELHVFQUFtRTtBQUNuRSw2RUFBeUU7QUFDekUsaURBQTZDO0FBQzdDLDRGQUE0QztBQUM1QyxpRUFBNkQ7QUFDN0QsMkRBQXVEO0FBQ3ZELGlFQUE2RDtBQUd0RCxNQUFNLFNBQVMsR0FBaUIsQ0FBQyxFQUFFLEVBQUUsRUFBRTtJQUM1QyxNQUFNLE9BQU8sR0FBRyxJQUFBLHlDQUFtQixFQUF3QixRQUFRLEVBQUU7UUFDbkUsTUFBTSxFQUFFLElBQUk7UUFDWixNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsSUFBSTtRQUMxRCxRQUFRLEVBQUUsRUFBRTtLQUNiLENBQUMsQ0FBQTtJQUNGLE1BQU0sTUFBTSxHQUFHLElBQUEscUJBQVMsR0FBRSxDQUFBO0lBQzFCLE1BQU0sR0FBRyxHQUFHLElBQUEsY0FBTSxFQUFpQixJQUFJLENBQUMsQ0FBQTtJQUV4QyxNQUFNLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxFQUFFLENBQUMsQ0FBQTtJQUN0QyxNQUFNLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBaUIsRUFBRSxDQUFDLENBQUE7SUFDMUQsTUFBTSxDQUFDLFlBQVksRUFBRSxlQUFlLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsS0FBSyxDQUFDLENBQUE7SUFFdkQsTUFBTSxhQUFhLEdBQUcsQ0FBQyxDQUFzQyxFQUFFLEVBQUU7UUFDL0QsUUFBUSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENB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QUFXLEVBQzdCLElBQUksRUFBQyxRQUFRLEVBQ2IsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUM7b0JBRXJDLDhCQUFDLHFCQUFTLElBQUMsS0FBSyxFQUFDLFNBQVMsR0FBRyxDQUNsQixDQUNUO1lBQ0wsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FDbkIsOEJBQUMsNkJBQWEsSUFBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxVQUFVLEdBQUksQ0FDNUQ7WUFDQSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxDQUNyQiw4QkFBQyw2QkFBYSxJQUNaLE9BQU8sRUFBRSxPQUFPLENBQUMsSUFBSSxJQUFJLEVBQUUsRUFDM0IsUUFBUSxFQUFFLE9BQU8sQ0FBQyxhQUFhLEVBQy9CLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLEdBQ3JDLENBQ0gsQ0FDSyxDQUNQLENBQ0osQ0FBQTtBQUNILENBQUMsQ0FBQTtBQTVHWSxRQUFBLFNBQVMsYUE0R3JCIiwiZmlsZSI6ImNsaWVudC90aGVtZS9TZWFyY2hCYXIvU2VhcmNoQmFyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xvc2VJY29uLCBJY29uQnV0dG9uLCBTZWFyY2hJY29uIH0gZnJvbSAnQGFjaWQtaW5mby9sc2QtcmVhY3QnXG5pbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBNb2RhbCB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvTW9kYWwvTW9kYWwnXG5pbXBvcnQgeyB1c2VQZXJzaXN0ZWRIaXN0b3J5IH0gZnJvbSAnLi4vLi4vbGliL3VzZVBlcnNpc3RlZEhpc3RvcnknXG5pbXBvcnQgeyB1c2VXaW5kb3dFdmVudExpc3RlbmVyIH0gZnJvbSAnLi4vLi4vbGliL3VzZVdpbmRvd0V2ZW50TGlzdGVuZXInXG5pbXBvcnQgeyB1c2VTZWFyY2ggfSBmcm9tICcuL2hvb2tzL3VzZVNlYXJjaCdcbmltcG9ydCBzdHlsZXMgZnJvbSAnLi9TZWFyY2hCYXIubW9kdWxlLnNjc3MnXG5pbXBvcnQgeyBTZWFyY2hIaXN0b3J5IH0gZnJvbSAnLi9TZWFyY2hIaXN0b3J5L1NlYXJjaEhpc3RvcnknXG5pbXBvcnQgeyBTZWFyY2hJbnB1dCB9IGZyb20gJy4vU2VhcmNoSW5wdXQvU2VhcmNoSW5wdXQnXG5pbXBvcnQgeyBTZWFyY2hSZXN1bHRzIH0gZnJvbSAnLi9TZWFyY2hSZXN1bHRzL1NlYXJjaFJlc3VsdHMnXG5pbXBvcnQgeyBTZWFyY2hSZXN1bHQsIFNlYXJjaFJlc3VsdEdyb3VwSXRlbSB9IGZyb20gJy4vdHlwZXMnXG5cbmV4cG9ydCBjb25zdCBTZWFyY2hCYXI6IFJlYWN0LkZDPHt9PiA9ICh7fSkgPT4ge1xuICBjb25zdCBoaXN0b3J5ID0gdXNlUGVyc2lzdGVkSGlzdG9yeTxTZWFyY2hSZXN1bHRHcm91cEl0ZW0+KCdzZWFyY2gnLCB7XG4gICAgdW5pcXVlOiB0cnVlLFxuICAgIGVxdWFsczogKGEsIGIpID0+IGEudGl0bGUgPT09IGIudGl0bGUgJiYgYS5ocmVmID09PSBiLmhyZWYsXG4gICAgbWF4SXRlbXM6IDEwLFxuICB9KVxuICBjb25zdCBzZWFyY2ggPSB1c2VTZWFyY2goKVxuICBjb25zdCByZWYgPSB1c2VSZWY8SFRNTERpdkVsZW1lbnQ+KG51bGwpXG5cbiAgY29uc3QgW2lucHV0LCBzZXRJbnB1dF0gPSB1c2VTdGF0ZSgnJylcbiAgY29uc3QgW3Jlc3VsdHMsIHNldFJlc3VsdHNdID0gdXNlU3RhdGU8U2VhcmNoUmVzdWx0W10+KFtdKVxuICBjb25zdCBbZGlzcGxheU1vZGFsLCBzZXREaXNwbGF5TW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpXG5cbiAgY29uc3Qgb25JbnB1dENoYW5nZSA9IChlOiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xuICAgIHNldElucHV0KGUudGFyZ2V0LnZhbHVlKVxuICB9XG5cbiAgY29uc3QgZm9jdXNPbklucHV0ID0gKCkgPT4ge1xuICAgIGNvbnN0IGVsID0gcmVmLmN1cnJlbnRcbiAgICBpZiAoIWVsKSByZXR1cm5cblxuICAgIGNvbnN0IGlucHV0RWwgPSBlbC5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpXG4gICAgaWYgKGlucHV0RWwpXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgaW5wdXRFbC5mb2N1cygpXG4gICAgICB9LCA1MClcbiAgfVxuXG4gIGNvbnN0IG9uQ2xlYXIgPSAoKSA9PiB7XG4gICAgc2V0SW5wdXQoJycpXG4gIH1cblxuICBjb25zdCBxdWVyeSA9IGFzeW5jIChpbnB1dDogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgeyByZXN1bHRzIH0gPSBhd2FpdCBzZWFyY2gucXVlcnkoaW5wdXQpXG4gICAgc2V0UmVzdWx0cyhyZXN1bHRzKVxuICB9XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoaW5wdXQubGVuZ3RoID4gMCkgcXVlcnkoaW5wdXQpXG4gICAgZWxzZSBzZXRSZXN1bHRzKFtdKVxuICB9LCBbaW5wdXRdKVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZGlzcGxheU1vZGFsID8gZm9jdXNPbklucHV0KCkgOiBzZXRJbnB1dCgnJylcbiAgfSwgW2Rpc3BsYXlNb2RhbF0pXG5cbiAgY29uc3Qgb25OYXZpZ2F0ZSA9IChcbiAgICBlOiBSZWFjdC5Nb3VzZUV2ZW50PEhUTUxBbmNob3JFbGVtZW50PixcbiAgICBpdGVtOiBTZWFyY2hSZXN1bHRHcm91cEl0ZW0sXG4gICkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIHNldERpc3BsYXlNb2RhbChmYWxzZSlcbiAgICBoaXN0b3J5LmFkZChpdGVtKVxuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gaXRlbS5ocmVmXG4gIH1cblxuICB1c2VXaW5kb3dFdmVudExpc3RlbmVyKFxuICAgICdrZXlkb3duJyxcbiAgICAoZXZlbnQpID0+IHtcbiAgICAgIGlmICgoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSAmJiBldmVudC5jb2RlID09PSAnS2V5SycpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICBzZXREaXNwbGF5TW9kYWwodHJ1ZSlcbiAgICAgIH1cbiAgICB9LFxuICAgIHt9LFxuICAgIFtdLFxuICApXG5cbiAgcmV0dXJuIChcbiAgICA8PlxuICAgICAgPEljb25CdXR0b24gb25DbGljaz17KCkgPT4gc2V0RGlzcGxheU1vZGFsKHRydWUpfSBzaXplPVwibWVkaXVtXCI+XG4gICAgICAgIDxTZWFyY2hJY29uIC8+XG4gICAgICA8L0ljb25CdXR0b24+XG4gICAgICA8TW9kYWxcbiAgICAgICAga2VlcE1vdW50ZWRcbiAgICAgICAgaWQ9XCJzZWFyY2gtbW9kYWxcIlxuICAgICAgICBvcGVuPXtkaXNwbGF5TW9kYWx9XG4gICAgICAgIG9uQ2xvc2U9eygpID0+IHNldERpc3BsYXlNb2RhbChmYWxzZSl9XG4gICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLm1vZGFsfVxuICAgICAgPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLmhlYWRlcn0+XG4gICAgICAgICAgPFNlYXJjaElucHV0XG4gICAgICAgICAgICBjb250YWluZXJSZWY9e3JlZn1cbiAgICAgICAgICAgIG9uQ2xlYXI9e29uQ2xlYXJ9XG4gICAgICAgICAgICB2YWx1ZT17aW5wdXR9XG4gICAgICAgICAgICBvbkNoYW5nZT17b25JbnB1dENoYW5nZX1cbiAgICAgICAgICAvPlxuICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICBjbGFzc05hbWU9e3N0eWxlcy5jbG9zZUJ1dHRvbn1cbiAgICAgICAgICAgIHNpemU9XCJtZWRpdW1cIlxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2V0RGlzcGxheU1vZGFsKGZhbHNlKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8Q2xvc2VJY29uIGNvbG9yPVwicHJpbWFyeVwiIC8+XG4gICAgICAgICAgPC9JY29uQnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAge2lucHV0Lmxlbmd0aCA+IDAgJiYgKFxuICAgICAgICAgIDxTZWFyY2hSZXN1bHRzIHJlc3VsdHM9e3Jlc3VsdHN9IG9uTmF2aWdhdGU9e29uTmF2aWdhdGV9IC8+XG4gICAgICAgICl9XG4gICAgICAgIHtpbnB1dC5sZW5ndGggPT09IDAgJiYgKFxuICAgICAgICAgIDxTZWFyY2hIaXN0b3J5XG4gICAgICAgICAgICBoaXN0b3J5PXtoaXN0b3J5Lmxpc3QgPz8gW119XG4gICAgICAgICAgICBvblJlbW92ZT17aGlzdG9yeS5yZW1vdmVCeUluZGV4fVxuICAgICAgICAgICAgb25DbG9zZT17KCkgPT4gc2V0RGlzcGxheU1vZGFsKGZhbHNlKX1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgPC9Nb2RhbD5cbiAgICA8Lz5cbiAgKVxufVxuIl19
