"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.HeroModel = void 0;
const tslib_1 = require("tslib");
const drei_1 = require("@react-three/drei");
const fiber_1 = require("@react-three/fiber");
const clsx_1 = tslib_1.__importDefault(require("clsx"));
const react_1 = tslib_1.__importStar(require("react"));
const HeroModel_configs_1 = require("./HeroModel.configs");
const ui_utils_1 = require("../../../lib/ui.utils");
const Ascii_1 = require("./Ascii");
const Controls_1 = require("./Controls");
require("./HeroModel.scss");
const useScrollY_1 = require("../../../lib/useScrollY");
const useLookPreset = (mode, preset, modelId) => {
    return (0, react_1.useMemo)(() => {
        if (preset)
            return { ...HeroModel_configs_1.defaultPresets, [mode]: preset };
        if (!modelId)
            return HeroModel_configs_1.defaultPresets;
        const existingPreset = HeroModel_configs_1.OBJECTS_PRESETS.find((p) => p.modelId === modelId);
        return existingPreset ? existingPreset : HeroModel_configs_1.defaultPresets;
    }, [preset, modelId]);
};
const getInitialY = (mode) => {
    return mode === 'abstract' ? 0 : window.innerWidth > 997 ? 0 : 0;
};
const HeroModel = (props) => {
    const { modelId, preset: presetProp, mode = 'simple', className, children, asciiConfig, rotateSpeed = HeroModel_configs_1.ROTATE_SPEED, enableZoom, enableRotateOnScroll, withParallelEffect = true, startY = 'bottom', ...divProps } = props;
    const preset = useLookPreset(mode, presetProp, modelId);
    // const index = 4;
    // const preset = OBJECTS_PRESETS[index] ? OBJECTS_PRESETS[index] : defaultPresets;
    const scrollY = (0, useScrollY_1.useScrollY)();
    return (react_1.default.createElement("div", { className: (0, clsx_1.default)(className, 'mdx-hero-model', 'mdx-hero-model--ascii', `mdx-hero-model--${mode}`, `mdx-hero-model--${startY}`), ...divProps },
        react_1.default.createElement("div", { className: `mdx-hero-model--inner`, style: {
                ...(withParallelEffect
                    ? {
                        transform: `translateY(${0
                        // getInitialY(mode) + scrollY * 0.1
                        }px) scale(var(--mdx-hero-model-wrapper-scale))`,
                    }
                    : {}),
            } },
            react_1.default.createElement(react_1.Suspense, { fallback: react_1.default.createElement("span", null, " ") },
                react_1.default.createElement(fiber_1.Canvas, { dpr: [1, 2], style: {
                        height: '100vh',
                    }, camera: {
                        fov: 50,
                        position: preset[mode].cameraPos,
                        rotation: preset[mode].cameraRot,
                    } },
                    react_1.default.createElement("directionalLight", { position: [-10, 10, 0], intensity: 1.5 }),
                    react_1.default.createElement("directionalLight", { position: [-10, 10, 5], intensity: 0.3 }),
                    react_1.default.createElement("directionalLight", { position: [-10, 20, 0], intensity: 1.5 }),
                    react_1.default.createElement("directionalLight", { position: [100, -10, 0], intensity: 0.25 }),
                    react_1.default.createElement(Controls_1.Controls, { rotateSpeed: rotateSpeed, preset: preset[mode], targetPreset: preset.targetLook, enableZoom: mode !== 'simple' },
                        react_1.default.createElement(react_1.Suspense, { fallback: react_1.default.createElement(Model, { url: `/hero/${preset.modelId}/lo.glb` }) },
                            react_1.default.createElement(Model, { url: `/hero/${preset.modelId}/hi.glb` }),
                            react_1.default.createElement(Ascii_1.AsciiRenderer, { ...asciiConfig })))))),
        react_1.default.createElement("div", { className: 'mdx-hero-model--shade', style: {
                opacity: (0, ui_utils_1.mapFloat)(scrollY, 0, (0, ui_utils_1.calcScrollThreshold)() * HeroModel_configs_1.RESIZE_SPEED_FACTOR, 0, 1),
            } })));
};
exports.HeroModel = HeroModel;
function Model({ url, onMount = () => { }, ...props }) {
    // useGLTF suspends the component, it literally stops processing
    const { scene } = (0, drei_1.useGLTF)(url, '/scripts/draco-1.4.3/');
    (0, react_1.useEffect)(() => {
        onMount();
    }, []);
    // By the time we're here the model is gueranteed to be available
    return react_1.default.createElement("primitive", { object: scene, ...props });
}
function Rotate(props) {
    const ref = (0, react_1.useRef)();
    (0, fiber_1.useFrame)((state) => {
        if (ref.current) {
            // @ts-ignore
            return (ref.current.rotation.y = state.clock.elapsedTime);
        }
        return ref;
    });
    return react_1.default.createElement("group", { ref: ref, ...props });
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbGllbnQvY29tcG9uZW50cy9tZHgvSGVyb01vZGVsL0hlcm9Nb2RlbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLDRDQUEyQztBQUMzQyw4Q0FBcUQ7QUFDckQsd0RBQXVCO0FBQ3ZCLHVEQUFtRTtBQU9uRSwyREFLNEI7QUFFNUIsb0RBQXFFO0FBQ3JFLG1DQUF1QztBQUN2Qyx5Q0FBcUM7QUFDckMsNEJBQXlCO0FBQ3pCLHdEQUFvRDtBQWVwRCxNQUFNLGFBQWEsR0FBRyxDQUNwQixJQUEyQixFQUMzQixNQUE2QixFQUM3QixPQUFnQixFQUNBLEVBQUU7SUFDbEIsT0FBTyxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7UUFDbEIsSUFBSSxNQUFNO1lBQUUsT0FBTyxFQUFFLEdBQUcsa0NBQWMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFBO1FBQ3hELElBQUksQ0FBQyxPQUFPO1lBQUUsT0FBTyxrQ0FBYyxDQUFBO1FBQ25DLE1BQU0sY0FBYyxHQUFHLG1DQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxLQUFLLE9BQU8sQ0FBQyxDQUFBO1FBQ3pFLE9BQU8sY0FBYyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLGtDQUFjLENBQUE7SUFDekQsQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUE7QUFDdkIsQ0FBQyxDQUFBO0FBRUQsTUFBTSxXQUFXLEdBQUcsQ0FBQyxJQUEyQixFQUFVLEVBQUU7SUFDMUQsT0FBTyxJQUFJLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUNsRSxDQUFDLENBQUE7QUFFTSxNQUFNLFNBQVMsR0FB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QyxFQUNELENBQUMsQ0FDRjthQUNGLEdBQ0QsQ0FDRSxDQUNQLENBQUE7QUFDSCxDQUFDLENBQUE7QUEzRlksUUFBQSxTQUFTLGFBMkZyQjtBQUVELFNBQVMsS0FBSyxDQUFDLEVBQUUsR0FBRyxFQUFFLE9BQU8sR0FBRyxHQUFHLEVBQUUsR0FBRSxDQUFDLEVBQUUsR0FBRyxLQUFLLEVBQUU7SUFDbEQsZ0VBQWdFO0lBQ2hFLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxJQUFBLGNBQU8sRUFBQyxHQUFHLEVBQUUsdUJBQXVCLENBQVEsQ0FBQTtJQUM5RCxJQUFBLGlCQUFTLEVBQUMsR0FBRyxFQUFFO1FBQ2IsT0FBTyxFQUFFLENBQUE7SUFDWCxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFDTixpRUFBaUU7SUFDakUsT0FBTyw2Q0FBVyxNQUFNLEVBQUUsS0FBSyxLQUFNLEtBQUssR0FBSSxDQUFBO0FBQ2hELENBQUM7QUFFRCxTQUFTLE1BQU0sQ0FBQyxLQUFLO0lBQ25CLE1BQU0sR0FBRyxHQUFHLElBQUEsY0FBTSxHQUFFLENBQUE7SUFDcEIsSUFBQSxnQkFBUSxFQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7UUFDakIsSUFBSSxHQUFHLENBQUMsT0FBTyxFQUFFO1lBQ2YsYUFBYTtZQUNiLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQTtTQUMxRDtRQUNELE9BQU8sR0FBRyxDQUFBO0lBQ1osQ0FBQyxDQUFDLENBQUE7SUFDRixPQUFPLHlDQUFPLEdBQUcsRUFBRSxHQUFHLEtBQU0sS0FBSyxHQUFJLENBQUE7QUFDdkMsQ0FBQyIsImZpbGUiOiJjbGllbnQvY29tcG9uZW50cy9tZHgvSGVyb01vZGVsL0hlcm9Nb2RlbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZUdMVEYgfSBmcm9tICdAcmVhY3QtdGhyZWUvZHJlaSdcbmltcG9ydCB7IENhbnZhcywgdXNlRnJhbWUgfSBmcm9tICdAcmVhY3QtdGhyZWUvZmliZXInXG5pbXBvcnQgY2xzeCBmcm9tICdjbHN4J1xuaW1wb3J0IFJlYWN0LCB7IFN1c3BlbnNlLCB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVJlZiB9IGZyb20gJ3JlYWN0J1xuXG5pbXBvcnQge1xuICBBc2NpaUNvbmZpZ3MsXG4gIExvb2tQcmVzZXRJdGVtLFxuICBMb29rUHJlc2V0SXRlbVZhbHVlcyxcbn0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvdWkudHlwZXMnXG5pbXBvcnQge1xuICBkZWZhdWx0UHJlc2V0cyxcbiAgT0JKRUNUU19QUkVTRVRTLFxuICBSRVNJWkVfU1BFRURfRkFDVE9SLFxuICBST1RBVEVfU1BFRUQsXG59IGZyb20gJy4vSGVyb01vZGVsLmNvbmZpZ3MnXG5cbmltcG9ydCB7IGNhbGNTY3JvbGxUaHJlc2hvbGQsIG1hcEZsb2F0IH0gZnJvbSAnLi4vLi4vLi4vbGliL3VpLnV0aWxzJ1xuaW1wb3J0IHsgQXNjaWlSZW5kZXJlciB9IGZyb20gJy4vQXNjaWknXG5pbXBvcnQgeyBDb250cm9scyB9IGZyb20gJy4vQ29udHJvbHMnXG5pbXBvcnQgJy4vSGVyb01vZGVsLnNjc3MnXG5pbXBvcnQgeyB1c2VTY3JvbGxZIH0gZnJvbSAnLi4vLi4vLi4vbGliL3VzZVNjcm9sbFknXG5cbmV4cG9ydCB0eXBlIEhlcm9Nb2RlbFByb3BzID0gUmVhY3QuSFRNTEF0dHJpYnV0ZXM8SFRNTERpdkVsZW1lbnQ+ICYge1xuICBtb2RlbElkPzogc3RyaW5nXG4gIHByZXNldD86IExvb2tQcmVzZXRJdGVtVmFsdWVzXG4gIG1vZGU/OiAnc2ltcGxlJyB8ICdhYnN0cmFjdCdcbiAgYXNjaWlDb25maWc/OiBBc2NpaUNvbmZpZ3NcbiAgcm90YXRlU3BlZWQ/OiBudW1iZXJcbiAgc3RhcnRZPzogJ3RvcCcgfCAnYm90dG9tJ1xuXG4gIGVuYWJsZVpvb20/OiBib29sZWFuXG4gIGVuYWJsZVJvdGF0ZU9uU2Nyb2xsPzogYm9vbGVhblxuICB3aXRoUGFyYWxsZWxFZmZlY3Q/OiBib29sZWFuXG59XG5cbmNvbnN0IHVzZUxvb2tQcmVzZXQgPSAoXG4gIG1vZGU6ICdhYnN0cmFjdCcgfCAnc2ltcGxlJyxcbiAgcHJlc2V0PzogTG9va1ByZXNldEl0ZW1WYWx1ZXMsXG4gIG1vZGVsSWQ/OiBzdHJpbmcsXG4pOiBMb29rUHJlc2V0SXRlbSA9PiB7XG4gIHJldHVybiB1c2VNZW1vKCgpID0+IHtcbiAgICBpZiAocHJlc2V0KSByZXR1cm4geyAuLi5kZWZhdWx0UHJlc2V0cywgW21vZGVdOiBwcmVzZXQgfVxuICAgIGlmICghbW9kZWxJZCkgcmV0dXJuIGRlZmF1bHRQcmVzZXRzXG4gICAgY29uc3QgZXhpc3RpbmdQcmVzZXQgPSBPQkpFQ1RTX1BSRVNFVFMuZmluZCgocCkgPT4gcC5tb2RlbElkID09PSBtb2RlbElkKVxuICAgIHJldHVybiBleGlzdGluZ1ByZXNldCA/IGV4aXN0aW5nUHJlc2V0IDogZGVmYXVsdFByZXNldHNcbiAgfSwgW3ByZXNldCwgbW9kZWxJZF0pXG59XG5cbmNvbnN0IGdldEluaXRpYWxZID0gKG1vZGU6ICdhYnN0cmFjdCcgfCAnc2ltcGxlJyk6IG51bWJlciA9PiB7XG4gIHJldHVybiBtb2RlID09PSAnYWJzdHJhY3QnID8gMCA6IHdpbmRvdy5pbm5lcldpZHRoID4gOTk3ID8gMCA6IDBcbn1cblxuZXhwb3J0IGNvbnN0IEhlcm9Nb2RlbCA9IChwcm9wczogSGVyb01vZGVsUHJvcHMpID0+IHtcbiAgY29uc3Qge1xuICAgIG1vZGVsSWQsXG4gICAgcHJlc2V0OiBwcmVzZXRQcm9wLFxuICAgIG1vZGUgPSAnc2ltcGxlJyxcbiAgICBjbGFzc05hbWUsXG4gICAgY2hpbGRyZW4sXG4gICAgYXNjaWlDb25maWcsXG4gICAgcm90YXRlU3BlZWQgPSBST1RBVEVfU1BFRUQsXG4gICAgZW5hYmxlWm9vbSxcbiAgICBlbmFibGVSb3RhdGVPblNjcm9sbCxcbiAgICB3aXRoUGFyYWxsZWxFZmZlY3QgPSB0cnVlLFxuICAgIHN0YXJ0WSA9ICdib3R0b20nLFxuICAgIC4uLmRpdlByb3BzXG4gIH0gPSBwcm9wc1xuXG4gIGNvbnN0IHByZXNldCA9IHVzZUxvb2tQcmVzZXQobW9kZSwgcHJlc2V0UHJvcCwgbW9kZWxJZClcbiAgLy8gY29uc3QgaW5kZXggPSA0O1xuICAvLyBjb25zdCBwcmVzZXQgPSBPQkpFQ1RTX1BSRVNFVFNbaW5kZXhdID8gT0JKRUNUU19QUkVTRVRTW2luZGV4XSA6IGRlZmF1bHRQcmVzZXRzO1xuICBjb25zdCBzY3JvbGxZID0gdXNlU2Nyb2xsWSgpXG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgJ21keC1oZXJvLW1vZGVsJyxcbiAgICAgICAgJ21keC1oZXJvLW1vZGVsLS1hc2NpaScsXG4gICAgICAgIGBtZHgtaGVyby1tb2RlbC0tJHttb2RlfWAsXG4gICAgICAgIGBtZHgtaGVyby1tb2RlbC0tJHtzdGFydFl9YCxcbiAgICAgICl9XG4gICAgICB7Li4uZGl2UHJvcHN9XG4gICAgPlxuICAgICAgPGRpdlxuICAgICAgICBjbGFzc05hbWU9e2BtZHgtaGVyby1tb2RlbC0taW5uZXJgfVxuICAgICAgICBzdHlsZT17e1xuICAgICAgICAgIC4uLih3aXRoUGFyYWxsZWxFZmZlY3RcbiAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHtcbiAgICAgICAgICAgICAgICAgIDBcbiAgICAgICAgICAgICAgICAgIC8vIGdldEluaXRpYWxZKG1vZGUpICsgc2Nyb2xsWSAqIDAuMVxuICAgICAgICAgICAgICAgIH1weCkgc2NhbGUodmFyKC0tbWR4LWhlcm8tbW9kZWwtd3JhcHBlci1zY2FsZSkpYCxcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgOiB7fSksXG4gICAgICAgIH19XG4gICAgICA+XG4gICAgICAgIDxTdXNwZW5zZSBmYWxsYmFjaz17PHNwYW4+IDwvc3Bhbj59PlxuICAgICAgICAgIDxDYW52YXNcbiAgICAgICAgICAgIGRwcj17WzEsIDJdfVxuICAgICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgICAgaGVpZ2h0OiAnMTAwdmgnLFxuICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIGNhbWVyYT17e1xuICAgICAgICAgICAgICBmb3Y6IDUwLFxuICAgICAgICAgICAgICBwb3NpdGlvbjogcHJlc2V0W21vZGVdLmNhbWVyYVBvcyxcbiAgICAgICAgICAgICAgcm90YXRpb246IHByZXNldFttb2RlXS5jYW1lcmFSb3QsXG4gICAgICAgICAgICB9fVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxkaXJlY3Rpb25hbExpZ2h0IHBvc2l0aW9uPXtbLTEwLCAxMCwgMF19IGludGVuc2l0eT17MS41fSAvPlxuICAgICAgICAgICAgPGRpcmVjdGlvbmFsTGlnaHQgcG9zaXRpb249e1stMTAsIDEwLCA1XX0gaW50ZW5zaXR5PXswLjN9IC8+XG4gICAgICAgICAgICA8ZGlyZWN0aW9uYWxMaWdodCBwb3NpdGlvbj17Wy0xMCwgMjAsIDBdfSBpbnRlbnNpdHk9ezEuNX0gLz5cbiAgICAgICAgICAgIDxkaXJlY3Rpb25hbExpZ2h0IHBvc2l0aW9uPXtbMTAwLCAtMTAsIDBdfSBpbnRlbnNpdHk9ezAuMjV9IC8+XG4gICAgICAgICAgICA8Q29udHJvbHNcbiAgICAgICAgICAgICAgcm90YXRlU3BlZWQ9e3JvdGF0ZVNwZWVkfVxuICAgICAgICAgICAgICBwcmVzZXQ9e3ByZXNldFttb2RlXX1cbiAgICAgICAgICAgICAgdGFyZ2V0UHJlc2V0PXtwcmVzZXQudGFyZ2V0TG9va31cbiAgICAgICAgICAgICAgZW5hYmxlWm9vbT17bW9kZSAhPT0gJ3NpbXBsZSd9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxTdXNwZW5zZVxuICAgICAgICAgICAgICAgIGZhbGxiYWNrPXs8TW9kZWwgdXJsPXtgL2hlcm8vJHtwcmVzZXQubW9kZWxJZH0vbG8uZ2xiYH0gLz59XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8TW9kZWwgdXJsPXtgL2hlcm8vJHtwcmVzZXQubW9kZWxJZH0vaGkuZ2xiYH0gLz5cbiAgICAgICAgICAgICAgICA8QXNjaWlSZW5kZXJlciB7Li4uYXNjaWlDb25maWd9IC8+XG4gICAgICAgICAgICAgIDwvU3VzcGVuc2U+XG4gICAgICAgICAgICA8L0NvbnRyb2xzPlxuICAgICAgICAgIDwvQ2FudmFzPlxuICAgICAgICA8L1N1c3BlbnNlPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzTmFtZT17J21keC1oZXJvLW1vZGVsLS1zaGFkZSd9XG4gICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgb3BhY2l0eTogbWFwRmxvYXQoXG4gICAgICAgICAgICBzY3JvbGxZLFxuICAgICAgICAgICAgMCxcbiAgICAgICAgICAgIGNhbGNTY3JvbGxUaHJlc2hvbGQoKSAqIFJFU0laRV9TUEVFRF9GQUNUT1IsXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICAgMSxcbiAgICAgICAgICApLFxuICAgICAgICB9fVxuICAgICAgLz5cbiAgICA8L2Rpdj5cbiAgKVxufVxuXG5mdW5jdGlvbiBNb2RlbCh7IHVybCwgb25Nb3VudCA9ICgpID0+IHt9LCAuLi5wcm9wcyB9KSB7XG4gIC8vIHVzZUdMVEYgc3VzcGVuZHMgdGhlIGNvbXBvbmVudCwgaXQgbGl0ZXJhbGx5IHN0b3BzIHByb2Nlc3NpbmdcbiAgY29uc3QgeyBzY2VuZSB9ID0gdXNlR0xURih1cmwsICcvc2NyaXB0cy9kcmFjby0xLjQuMy8nKSBhcyBhbnlcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBvbk1vdW50KClcbiAgfSwgW10pXG4gIC8vIEJ5IHRoZSB0aW1lIHdlJ3JlIGhlcmUgdGhlIG1vZGVsIGlzIGd1ZXJhbnRlZWQgdG8gYmUgYXZhaWxhYmxlXG4gIHJldHVybiA8cHJpbWl0aXZlIG9iamVjdD17c2NlbmV9IHsuLi5wcm9wc30gLz5cbn1cblxuZnVuY3Rpb24gUm90YXRlKHByb3BzKSB7XG4gIGNvbnN0IHJlZiA9IHVzZVJlZigpXG4gIHVzZUZyYW1lKChzdGF0ZSkgPT4ge1xuICAgIGlmIChyZWYuY3VycmVudCkge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgcmV0dXJuIChyZWYuY3VycmVudC5yb3RhdGlvbi55ID0gc3RhdGUuY2xvY2suZWxhcHNlZFRpbWUpXG4gICAgfVxuICAgIHJldHVybiByZWZcbiAgfSlcbiAgcmV0dXJuIDxncm91cCByZWY9e3JlZn0gey4uLnByb3BzfSAvPlxufVxuIl19
